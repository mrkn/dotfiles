#!/bin/bash

PREFIX=/opt/arrow-dev

while [[ $# -gt 0 ]]; do
  case "$1" in
    --prefix)
      shift
      PREFIX="$1"
      ;;
    --)
      shift
      break
      ;;
  esac
  shift
done

export PKG_CONFIG_PATH=$PREFIX/lib/pkgconfig:$PREFIX/lib/x86_64-linux-gnu/pkgconfig:$PKG_CONFIG_PATH

libdir=$(pkg-config --variable=libdir arrow)
export LD_LIBRARY_PATH=${libdir}:$LD_LIBRARY_PATH
export DYLD_LIBRARY_PATH=${libdir}:$DYLD_LIBRARY_PATH
export GI_TYPELIB_PATH=${libdir}/girepository-1.0:$GI_TYPELIB_PATH
unset libdir

case "$1" in
  ruby)
    if [ $(which ruby) = $(echo ~/.rbenv/shims/ruby) ]; then
      shift
      $(rbenv which ruby) "$@"
    else
      "$@"
    fi
    ;;
  *)
    "$@"
    ;;
esac
